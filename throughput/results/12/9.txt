BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272044191.328234
 ALGERIA                   |   1997 | 454741220.146955
 ALGERIA                   |   1996 | 463667103.012861
 ALGERIA                   |   1995 | 468802360.058002
 ALGERIA                   |   1994 | 459590884.374361
 ALGERIA                   |   1993 | 455915658.552527
 ALGERIA                   |   1992 | 458126274.727872
 ARGENTINA                 |   1998 |  279835321.97701
 ARGENTINA                 |   1997 | 462290799.842685
 ARGENTINA                 |   1996 | 468155140.923465
 ARGENTINA                 |   1995 | 468394403.840889
 ARGENTINA                 |   1994 | 466335357.376321
 ARGENTINA                 |   1993 | 463967773.377433
 ARGENTINA                 |   1992 | 470099473.916621
 BRAZIL                    |   1998 | 267467434.765392
 BRAZIL                    |   1997 | 464946541.846661
 BRAZIL                    |   1996 | 457257568.726431
 BRAZIL                    |   1995 | 463821132.224908
 BRAZIL                    |   1994 | 449969609.561891
 BRAZIL                    |   1993 | 457281416.637324
 BRAZIL                    |   1992 | 464224764.030191
 CANADA                    |   1998 | 276191865.693521
 CANADA                    |   1997 | 473532294.577232
 CANADA                    |   1996 | 466734206.444259
 CANADA                    |   1995 | 471402635.957253
 CANADA                    |   1994 | 478506120.950287
 CANADA                    |   1993 | 476693937.469741
 CANADA                    |   1992 | 478160484.221819
 CHINA                     |   1998 | 272408129.114549
 CHINA                     |   1997 | 458876988.514506
 CHINA                     |   1996 |  472099669.83983
 CHINA                     |   1995 | 468980691.048772
 CHINA                     |   1994 | 466036941.153832
 CHINA                     |   1993 | 469977258.532681
 CHINA                     |   1992 |  460790643.13906
 EGYPT                     |   1998 | 267715308.876949
 EGYPT                     |   1997 | 461129507.017803
 EGYPT                     |   1996 |  467081613.33909
 EGYPT                     |   1995 | 456379142.263321
 EGYPT                     |   1994 | 448285801.924909
 EGYPT                     |   1993 | 462246996.986507
 EGYPT                     |   1992 | 459446069.101369
 ETHIOPIA                  |   1998 | 273543283.132438
 ETHIOPIA                  |   1997 | 455163364.808272
 ETHIOPIA                  |   1996 | 455828964.063388
 ETHIOPIA                  |   1995 | 450282339.357065
 ETHIOPIA                  |   1994 | 452665681.167099
 ETHIOPIA                  |   1993 | 461064240.150632
 ETHIOPIA                  |   1992 | 458896423.316109
 FRANCE                    |   1998 | 269754174.441333
 FRANCE                    |   1997 | 464635479.608363
 FRANCE                    |   1996 |  466441709.74083
 FRANCE                    |   1995 | 462944373.155625
 FRANCE                    |   1994 | 469815669.387782
 FRANCE                    |   1993 | 464478890.175988
 FRANCE                    |   1992 |  460041150.22805
 GERMANY                   |   1998 | 277846624.360795
 GERMANY                   |   1997 | 474062837.692534
 GERMANY                   |   1996 |  468065688.61865
 GERMANY                   |   1995 | 480085901.162085
 GERMANY                   |   1994 | 472322329.664026
 GERMANY                   |   1993 | 471983795.069565
 GERMANY                   |   1992 | 467649568.595908
 INDIA                     |   1998 | 272429304.905741
 INDIA                     |   1997 | 473163855.299287
 INDIA                     |   1996 |  477177967.89819
 INDIA                     |   1995 |  473269811.05395
 INDIA                     |   1994 |  476575389.66236
 INDIA                     |   1993 | 470520202.624182
 INDIA                     |   1992 | 470918405.949009
 INDONESIA                 |   1998 |  274527931.19463
 INDONESIA                 |   1997 | 461343802.910958
 INDONESIA                 |   1996 | 465812756.055967
 INDONESIA                 |   1995 | 463516708.071292
 INDONESIA                 |   1994 | 458527088.233082
 INDONESIA                 |   1993 | 457733274.795735
 INDONESIA                 |   1992 | 455789588.927739
 IRAN                      |   1998 | 270786823.104942
 IRAN                      |   1997 | 460055890.281691
 IRAN                      |   1996 | 459997431.399711
 IRAN                      |   1995 | 464149265.981288
 IRAN                      |   1994 | 452613593.544234
 IRAN                      |   1993 | 461888075.657034
 IRAN                      |   1992 | 466043304.183669
 IRAQ                      |   1998 | 279918951.350002
 IRAQ                      |   1997 | 465333490.239165
 IRAQ                      |   1996 | 476379830.952088
 IRAQ                      |   1995 | 473014137.901461
 IRAQ                      |   1994 | 477107419.654005
 IRAQ                      |   1993 | 466688726.175268
 IRAQ                      |   1992 | 474924104.405761
 JAPAN                     |   1998 |  262156057.79605
 JAPAN                     |   1997 | 464644869.230498
 JAPAN                     |   1996 | 461395880.782475
 JAPAN                     |   1995 | 458493483.300428
 JAPAN                     |   1994 | 454387397.090361
 JAPAN                     |   1993 |  460859309.50187
 JAPAN                     |   1992 | 460211070.981461
 JORDAN                    |   1998 | 270939782.787777
 JORDAN                    |   1997 | 462007663.507834
 JORDAN                    |   1996 | 459878473.373962
 JORDAN                    |   1995 | 461116796.547392
 JORDAN                    |   1994 | 459233530.039668
 JORDAN                    |   1993 | 472485761.887296
 JORDAN                    |   1992 | 459961151.627118
 KENYA                     |   1998 | 281021522.207432
 KENYA                     |   1997 |  462936720.24511
 KENYA                     |   1996 |  473273894.46827
 KENYA                     |   1995 | 473023414.100758
 KENYA                     |   1994 | 477939429.091026
 KENYA                     |   1993 | 472432727.448298
 KENYA                     |   1992 |  476010904.76315
 MOROCCO                   |   1998 | 272882969.989538
 MOROCCO                   |   1997 | 470567031.533154
 MOROCCO                   |   1996 | 477790516.048963
 MOROCCO                   |   1995 | 470813768.522572
 MOROCCO                   |   1994 | 470222677.203134
 MOROCCO                   |   1993 | 467094392.632131
 MOROCCO                   |   1992 | 469163178.514303
 MOZAMBIQUE                |   1998 | 275586790.758447
 MOZAMBIQUE                |   1997 | 465473794.058347
 MOZAMBIQUE                |   1996 | 473619276.617535
 MOZAMBIQUE                |   1995 | 467613799.340274
 MOZAMBIQUE                |   1994 | 465148090.804284
 MOZAMBIQUE                |   1993 | 465993302.451005
 MOZAMBIQUE                |   1992 | 458110642.091985
 PERU                      |   1998 |  265923730.64403
 PERU                      |   1997 | 456989615.683924
 PERU                      |   1996 | 467113195.185123
 PERU                      |   1995 | 463246751.573767
 PERU                      |   1994 |  459207248.61427
 PERU                      |   1993 | 453700441.495488
 PERU                      |   1992 | 464117177.506173
 ROMANIA                   |   1998 | 278250868.846626
 ROMANIA                   |   1997 | 478113629.547171
 ROMANIA                   |   1996 | 477332197.672666
 ROMANIA                   |   1995 | 467482420.593541
 ROMANIA                   |   1994 |  473497364.98303
 ROMANIA                   |   1993 | 469586302.132103
 ROMANIA                   |   1992 |  470489027.11904
 RUSSIA                    |   1998 | 272480732.205145
 RUSSIA                    |   1997 | 464365733.280387
 RUSSIA                    |   1996 | 465009859.283915
 RUSSIA                    |   1995 |  468794887.83205
 RUSSIA                    |   1994 | 462533384.616003
 RUSSIA                    |   1993 | 464621888.907535
 RUSSIA                    |   1992 | 464598541.903611
 SAUDI ARABIA              |   1998 | 277575350.620909
 SAUDI ARABIA              |   1997 | 467883057.385132
 SAUDI ARABIA              |   1996 | 465680739.512189
 SAUDI ARABIA              |   1995 | 475568856.206477
 SAUDI ARABIA              |   1994 | 467341056.561094
 SAUDI ARABIA              |   1993 | 470318737.121193
 SAUDI ARABIA              |   1992 | 473893191.304947
 UNITED KINGDOM            |   1998 | 269428646.846156
 UNITED KINGDOM            |   1997 | 455505772.155273
 UNITED KINGDOM            |   1996 | 449277636.285427
 UNITED KINGDOM            |   1995 | 458125579.167915
 UNITED KINGDOM            |   1994 | 459337665.768065
 UNITED KINGDOM            |   1993 | 458177701.529498
 UNITED KINGDOM            |   1992 | 446212592.892197
 UNITED STATES             |   1998 | 274624636.397524
 UNITED STATES             |   1997 |  483379372.24336
 UNITED STATES             |   1996 | 480338694.256181
 UNITED STATES             |   1995 |  472305591.78236
 UNITED STATES             |   1994 |   476031951.0128
 UNITED STATES             |   1993 | 475352256.308127
 UNITED STATES             |   1992 | 477393894.401497
 VIETNAM                   |   1998 | 273410195.815963
 VIETNAM                   |   1997 | 466453624.043806
 VIETNAM                   |   1996 | 476410371.903571
 VIETNAM                   |   1995 | 457704493.671832
 VIETNAM                   |   1994 |  464327668.72844
 VIETNAM                   |   1993 | 464607749.177697
 VIETNAM                   |   1992 | 473638238.726333
(175 rows)

COMMIT;
COMMIT

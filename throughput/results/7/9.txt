BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268602068.084556
 ALGERIA                   |   1997 | 460596845.144526
 ALGERIA                   |   1996 | 465530866.663825
 ALGERIA                   |   1995 | 469231232.048123
 ALGERIA                   |   1994 | 460930951.707548
 ALGERIA                   |   1993 | 467473501.436181
 ALGERIA                   |   1992 | 466951118.830663
 ARGENTINA                 |   1998 | 275340101.593941
 ARGENTINA                 |   1997 | 471432815.958322
 ARGENTINA                 |   1996 | 471567280.569235
 ARGENTINA                 |   1995 | 467822040.840669
 ARGENTINA                 |   1994 | 471869661.870018
 ARGENTINA                 |   1993 | 470571791.694265
 ARGENTINA                 |   1992 | 466536940.556711
 BRAZIL                    |   1998 | 272966177.043932
 BRAZIL                    |   1997 | 461585085.240174
 BRAZIL                    |   1996 | 460355958.174486
 BRAZIL                    |   1995 | 462465654.821005
 BRAZIL                    |   1994 | 465019699.828525
 BRAZIL                    |   1993 | 468298506.775279
 BRAZIL                    |   1992 | 463219402.171281
 CANADA                    |   1998 | 276788316.199444
 CANADA                    |   1997 | 483392257.133175
 CANADA                    |   1996 | 481336701.282327
 CANADA                    |   1995 | 476840228.403615
 CANADA                    |   1994 |  485211915.44051
 CANADA                    |   1993 | 475480147.422387
 CANADA                    |   1992 | 476646780.801004
 CHINA                     |   1998 | 274303111.425812
 CHINA                     |   1997 |  470012965.31486
 CHINA                     |   1996 | 468480110.186427
 CHINA                     |   1995 | 461514271.529612
 CHINA                     |   1994 | 466437589.920514
 CHINA                     |   1993 | 468259151.353564
 CHINA                     |   1992 | 466220397.729428
 EGYPT                     |   1998 | 277350972.735874
 EGYPT                     |   1997 | 465709279.693146
 EGYPT                     |   1996 | 468841834.465059
 EGYPT                     |   1995 | 465311610.966504
 EGYPT                     |   1994 |  463448096.07475
 EGYPT                     |   1993 | 473813694.111505
 EGYPT                     |   1992 | 464170307.317338
 ETHIOPIA                  |   1998 |  271402467.58089
 ETHIOPIA                  |   1997 | 462563146.797685
 ETHIOPIA                  |   1996 | 452995088.840004
 ETHIOPIA                  |   1995 | 459566311.834492
 ETHIOPIA                  |   1994 | 467099779.489407
 ETHIOPIA                  |   1993 | 451975088.483055
 ETHIOPIA                  |   1992 | 470885159.218682
 FRANCE                    |   1998 | 271216967.345672
 FRANCE                    |   1997 | 464058438.793144
 FRANCE                    |   1996 | 467591894.371908
 FRANCE                    |   1995 | 465310964.480246
 FRANCE                    |   1994 | 465279081.080249
 FRANCE                    |   1993 |  469933066.54788
 FRANCE                    |   1992 | 471784502.265785
 GERMANY                   |   1998 | 272736785.405173
 GERMANY                   |   1997 | 465644178.660994
 GERMANY                   |   1996 |  471416002.07239
 GERMANY                   |   1995 | 470315972.305556
 GERMANY                   |   1994 |  466833894.64858
 GERMANY                   |   1993 | 469261802.852701
 GERMANY                   |   1992 | 468338674.368269
 INDIA                     |   1998 | 276957857.677968
 INDIA                     |   1997 | 469614628.678529
 INDIA                     |   1996 | 473986156.970394
 INDIA                     |   1995 | 463488009.522808
 INDIA                     |   1994 | 470664251.861699
 INDIA                     |   1993 | 467526860.284972
 INDIA                     |   1992 | 465660800.531558
 INDONESIA                 |   1998 | 278233201.433192
 INDONESIA                 |   1997 | 467763049.657515
 INDONESIA                 |   1996 |  467706474.50223
 INDONESIA                 |   1995 | 468789997.376613
 INDONESIA                 |   1994 | 465279888.171735
 INDONESIA                 |   1993 | 473706107.965129
 INDONESIA                 |   1992 | 460725923.219253
 IRAN                      |   1998 | 267493469.723372
 IRAN                      |   1997 | 465087926.576153
 IRAN                      |   1996 | 456792004.638053
 IRAN                      |   1995 | 458935654.118721
 IRAN                      |   1994 | 458353260.100993
 IRAN                      |   1993 | 457380674.681741
 IRAN                      |   1992 | 463345446.988428
 IRAQ                      |   1998 | 274815521.196965
 IRAQ                      |   1997 | 472821591.175799
 IRAQ                      |   1996 | 478059955.850602
 IRAQ                      |   1995 | 470919590.141786
 IRAQ                      |   1994 |  468847218.14709
 IRAQ                      |   1993 | 483152399.617015
 IRAQ                      |   1992 | 478058960.290302
 JAPAN                     |   1998 | 269257306.725521
 JAPAN                     |   1997 | 467606702.979622
 JAPAN                     |   1996 | 469270310.554771
 JAPAN                     |   1995 | 469019343.521762
 JAPAN                     |   1994 |  468612199.95781
 JAPAN                     |   1993 |  476370287.92177
 JAPAN                     |   1992 | 473072865.090767
 JORDAN                    |   1998 |  269766420.19301
 JORDAN                    |   1997 | 454293152.263598
 JORDAN                    |   1996 | 456553438.869989
 JORDAN                    |   1995 | 459882983.445761
 JORDAN                    |   1994 |  458524162.02895
 JORDAN                    |   1993 | 456413452.864842
 JORDAN                    |   1992 | 455426730.668981
 KENYA                     |   1998 | 280190019.260494
 KENYA                     |   1997 |  480896562.46335
 KENYA                     |   1996 | 481442770.196607
 KENYA                     |   1995 | 471712456.952355
 KENYA                     |   1994 | 468632588.244086
 KENYA                     |   1993 | 473159115.594816
 KENYA                     |   1992 | 470152500.658176
 MOROCCO                   |   1998 | 274546947.179511
 MOROCCO                   |   1997 | 475442474.914898
 MOROCCO                   |   1996 | 469203121.469787
 MOROCCO                   |   1995 | 472032439.325098
 MOROCCO                   |   1994 | 472791219.003822
 MOROCCO                   |   1993 | 473834092.564201
 MOROCCO                   |   1992 | 475480139.279433
 MOZAMBIQUE                |   1998 | 277358346.212251
 MOZAMBIQUE                |   1997 | 460794565.562997
 MOZAMBIQUE                |   1996 | 463996260.237218
 MOZAMBIQUE                |   1995 | 466104489.962281
 MOZAMBIQUE                |   1994 | 466793409.124748
 MOZAMBIQUE                |   1993 | 466090552.251896
 MOZAMBIQUE                |   1992 | 457640960.455133
 PERU                      |   1998 | 274423047.399671
 PERU                      |   1997 | 467626832.468658
 PERU                      |   1996 | 467555137.565564
 PERU                      |   1995 | 463123844.828848
 PERU                      |   1994 | 466065382.645836
 PERU                      |   1993 | 465436418.070157
 PERU                      |   1992 | 471419890.782511
 ROMANIA                   |   1998 | 275901508.625778
 ROMANIA                   |   1997 | 477416594.938367
 ROMANIA                   |   1996 | 470674001.872305
 ROMANIA                   |   1995 | 471003295.777743
 ROMANIA                   |   1994 | 470247886.538478
 ROMANIA                   |   1993 | 470473315.388869
 ROMANIA                   |   1992 | 474433871.496564
 RUSSIA                    |   1998 |  268821005.70272
 RUSSIA                    |   1997 | 467391813.786637
 RUSSIA                    |   1996 | 476486018.624642
 RUSSIA                    |   1995 | 470928453.587283
 RUSSIA                    |   1994 | 467306408.265888
 RUSSIA                    |   1993 | 472449972.140186
 RUSSIA                    |   1992 | 465460146.034979
 SAUDI ARABIA              |   1998 | 272395120.508901
 SAUDI ARABIA              |   1997 | 473914929.981458
 SAUDI ARABIA              |   1996 | 472673384.081457
 SAUDI ARABIA              |   1995 | 468061380.289317
 SAUDI ARABIA              |   1994 | 468456959.010825
 SAUDI ARABIA              |   1993 | 467677270.957437
 SAUDI ARABIA              |   1992 | 469396055.433082
 UNITED KINGDOM            |   1998 | 263257761.218096
 UNITED KINGDOM            |   1997 | 467884783.110545
 UNITED KINGDOM            |   1996 | 471929773.096461
 UNITED KINGDOM            |   1995 | 463075633.939142
 UNITED KINGDOM            |   1994 | 462880914.923928
 UNITED KINGDOM            |   1993 |  463434264.19216
 UNITED KINGDOM            |   1992 | 468064543.001046
 UNITED STATES             |   1998 | 281067203.747834
 UNITED STATES             |   1997 | 479561539.760249
 UNITED STATES             |   1996 | 470164711.983491
 UNITED STATES             |   1995 | 470500892.486641
 UNITED STATES             |   1994 | 468286089.335677
 UNITED STATES             |   1993 | 472141650.296394
 UNITED STATES             |   1992 | 471846491.917219
 VIETNAM                   |   1998 |  276596729.76462
 VIETNAM                   |   1997 | 467126858.990873
 VIETNAM                   |   1996 | 474894986.604643
 VIETNAM                   |   1995 |  468239461.47504
 VIETNAM                   |   1994 | 469090289.927005
 VIETNAM                   |   1993 | 466809107.592566
 VIETNAM                   |   1992 | 462040792.731266
(175 rows)

COMMIT;
COMMIT
